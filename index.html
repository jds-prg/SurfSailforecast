<!DOCTYPE html>
<html lang="nl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SurfSailforecast</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>

<body>
  <!-- Hamburger-menu bovenaan -->
  <div class="hamburger-menu">
    <div class="hamburger-icon" onclick="document.getElementById('popupnav').classList.toggle('show');">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <div id="popupnav" class="popupnav">
      <button onclick="document.getElementById('map').scrollIntoView({behavior:'smooth'});document.getElementById('popupnav').classList.remove('show');" class="navbtn">Kaart</button>
      <button onclick="document.getElementById('voorspelingen').scrollIntoView({behavior:'smooth'});document.getElementById('popupnav').classList.remove('show');" class="navbtn">Voorspellingen</button>
      <button onclick="document.getElementById('data').scrollIntoView({behavior:'smooth'});document.getElementById('popupnav').classList.remove('show');" class="navbtn">Huidige Metingen</button>
      <button onclick="document.getElementById('webcam').scrollIntoView({behavior:'smooth'});document.getElementById('popupnav').classList.remove('show');" class="navbtn">Webcam</button>
      <button onclick="document.getElementById('getijden').scrollIntoView({behavior:'smooth'});document.getElementById('popupnav').classList.remove('show');" class="navbtn">Getijden</button>
      <button onclick="document.getElementById('linken').scrollIntoView({behavior:'smooth'});document.getElementById('popupnav').classList.remove('show');" class="navbtn">Surfschool</button>
      <button onclick="document.getElementById('wing-title').scrollIntoView({behavior:'smooth'});document.getElementById('popupnav').classList.remove('show');" class="navbtn">Wing-calculator</button>
      <button onclick="document.getElementById('kite-title').scrollIntoView({behavior:'smooth'});document.getElementById('popupnav').classList.remove('show');" class="navbtn">Kite-calculator</button>
      <button onclick="document.getElementById('contact').scrollIntoView({behavior:'smooth'});document.getElementById('popupnav').classList.remove('show');" class="navbtn">Contact</button>
    </div>
  </div>
  <div>
    <h1 id="titel"></h1>
  </div>

  <!-- Kaart -->
  <div class="section">
    <h2 id="tusentitel"> Blankenberge :</h2>
    <img id="map" src="kaart balnkenberge.png" >
  
  </div>

  <!-- Huidige Data -->
  <div class="section">
    <h2 id="titel-data">Gedetailleerde meetgegevens :</h2>
    <table id="detailedData">
        <thead>
            <tr>
                <th><i class="fas fa-tag"></i> Parameter</th>
                <th><i class="fas fa-chart-line"></i> Waarde</th>
                <th><i class="fas fa-clock"></i> Tijdstip</th>
                <th><i class="fas fa-map-marker-alt"></i> Locatie</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data wordt hier ingevuld -->
        </tbody>
    </table>
  </div>

  <!-- Voorspellingen met Windguru-widget -->
  <div class="section">
    <h3 id="voorspelingen">3-daagse Voorspelling :</h3>
    <div id="windguru-widget-container">
      <script id="wg_fwdg_1247345_100_1753296988982">
        (function (window, document) {
          var loader = function () {
            var arg = [
              "s=1247345",
              "m=100",
              "uid=wg_fwdg_1247345_100_1753296988982",
              "ai=0",
              "wj=knots",
              "tj=c",
              "waj=m",
              "tij=cm",
              "odh=0",
              "doh=24",
              "fhours=240",
              "hrsm=2",
              "vt=forecasts",
              "lng=nl",
              "idbs=1",
              "p=WINDSPD,GUST,SMER,TMPE,FLHGT,CDC,APCP1s,RATING"
            ];
            var script = document.createElement("script");
            var tag = document.getElementsByTagName("script")[0];
            script.src = "https://www.windguru.cz/js/widget.php?" + arg.join("&");
            tag.parentNode.insertBefore(script, tag);
          };
          window.addEventListener ? window.addEventListener("load", loader, false) : window.attachEvent("onload", loader);
        })(window, document);
      </script>
    </div>
  </div>

  <!-- windroos voor duiding -->
  <div class="roos">
    <h3 id="windroos">Maritieme informatie :</h3>
    <img src="beaufortschaal.png">
  </div>

  <!-- webcam pagina verwijst naar andere html met webcams -->
  <h4 id="webcam">Beachcams :</h4>
  <div class="positieknop">
    <a href="htmlwebcam.html" target="_blank" title="Dit brengt u bij de Beachcams">
      <button id="webcamknop"></button>
    </a>
  </div>

  <!-- webcam pagina verwijst naar andere html met getijden -->
  <h4 id="getijden">Getijden :</h4>
  <div class="positieknop">
    <a href="getijden.html" target="_blank" title="Dit brengt u bij de getijden">
      <button id="getijdenknop"></button>
    </a>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-arrowheads@1.3.0/dist/leaflet-arrowheads.js"></script>

  <script>
  

    // Configuratie voor data fetching
    const CONFIG = {
        API_URL: "https://api.meetnetvlaamsebanken.be",
        USERNAME: "smedtronics.tech@gmail.com",
        PASSWORD: "2007Jarne!",
        REFRESH_INTERVAL: 7 * 60 * 1000,
        LOCATION_IDS: [
            "BL7WC3", "BL7WRS", "BL7WVC", 
            "BLBGH1", "BLBGHA", "BLBGTZ", 
            "BLBHLF", "BLBRHF", "BLBRLF", 
            "BLBTZW", "BLKWS5"
        ],
        PARAMETER_NAMES: {
            'BL7WC3': 'Windstoten (3s)',
            'BL7WRS': 'Windrichting',
            'BL7WVC': 'Windsnelheid',
            'BLBGH1': '10% hoogste golven',
            'BLBGHA': 'Gemiddelde golfhoogte',
            'BLBGTZ': 'Gemiddelde golfperiode',
            'BLBHLF': 'Hoogte deining',
            'BLBRHF': 'Golfrichting (korte periode)',
            'BLBRLF': 'Golfrichting (lange periode)',
            'BLBTZW': 'Zeewatertemperatuur',
            'BLKWS5': 'Getij (TAW)'
        },
        LOCATION_NAMES: {
            'BL7': 'Blankenberge - Windmeting',
            'BLB': 'Blankenberge - Boei',
            'BLK': 'Blankenberge - Getij'
        }
    };

    const helpers = {
        msToKnots: (ms) => ms * 1.94384,
        formatTime: (date) => {
            if (!date) return '-';
            return date.toLocaleTimeString('nl-NL', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        },
        getParameterName: (id) => CONFIG.PARAMETER_NAMES[id] || id,
        getLocationName: (id) => {
            const prefix = id.substring(0, 3);
            return CONFIG.LOCATION_NAMES[prefix] || id;
        },
        getUnit: (id) => {
            if (id.includes('WVC') || id.includes('WC3')) return ' kn';
            if (id.includes('GHA') || id.includes('GH1') || id.includes('WS5')) return ' cm';
            if (id.includes('TZW')) return ' 째C';
            if (id.includes('GTZ')) return ' s';
            if (id.includes('RHF') || id.includes('RLF') || id.includes('WRS')) return '째';
            return '';
        }
    };

    const api = {
        getToken: async () => {
            try {
                const response = await fetch(`${CONFIG.API_URL}/Token`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: `grant_type=password&username=${encodeURIComponent(CONFIG.USERNAME)}&password=${encodeURIComponent(CONFIG.PASSWORD)}`
                });
                if (!response.ok) throw new Error(`Token request failed: ${response.status}`);
                const data = await response.json();
                return data.access_token;
            } catch (error) {
                console.error("Error getting token:", error);
                return null;
            }
        },
        fetchData: async () => {
            const token = await api.getToken();
            if (!token) return null;
            try {
                const response = await fetch(
                    `${CONFIG.API_URL}/V2/currentData?ids=${CONFIG.LOCATION_IDS.join(",")}`,
                    { headers: { "Authorization": `Bearer ${token}` } }
                );
                if (!response.ok) throw new Error(`Data request failed: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("Error getting data:", error);
                return null;
            }
        }
    };

    const renderDetailedTable = (rawData) => {
        const tbody = document.querySelector('#detailedData tbody');
        if (!rawData) {
            tbody.innerHTML = '<tr><td colspan="4">Geen data beschikbaar</td></tr>';
            return;
        }
        function degToCompass(deg) {
            const dirs = ['N', 'NNO', 'NO', 'ONO', 'O', 'OZO', 'ZO', 'ZZO', 'Z', 'ZZW', 'ZW', 'WZW', 'W', 'WNW', 'NW', 'NNW', 'N'];
            return dirs[Math.round(((deg % 360) / 22.5))];
        }

        tbody.innerHTML = rawData.map(item => {
            let value = item.Value;
            let formattedValue = '-';
            const unit = helpers.getUnit(item.ID);
            let extra = '';
            // Voeg windrichting toe bij graden
            if (item.ID.includes('RHF') || item.ID.includes('RLF') || item.ID.includes('WRS')) {
                formattedValue = value.toFixed(0) + unit;
                extra = ` (${degToCompass(value)})`;
            } else if (item.ID.includes('WVC') || item.ID.includes('WC3')) {
                value = helpers.msToKnots(value);
                formattedValue = value.toFixed(1) + unit;
            } else if (item.ID.includes('GHA') || item.ID.includes('GH1') || item.ID.includes('WS5')) {
                formattedValue = value.toFixed(1) + unit;
            } else if (item.ID.includes('TZW')) {
                formattedValue = value.toFixed(1) + unit;
            } else if (item.ID.includes('GTZ')) {
                formattedValue = value.toFixed(1) + unit;
            } else {
                formattedValue = value + unit;
            }
            return `
                <tr>
                    <td>${helpers.getParameterName(item.ID)}</td>
                    <td>${formattedValue}${extra}</td>
                    <td>${helpers.formatTime(new Date(item.Timestamp))}</td>
                    <td>${helpers.getLocationName(item.ID)}</td>
                </tr>
            `;
        }).join('');
    };

    const loadData = async () => {
        const rawData = await api.fetchData();
        if (!rawData) {
            renderDetailedTable(null);
            return;
        }
        // Filter alleen Blankenberge data
        const blData = rawData.filter(item => item.ID && item.ID.startsWith('BL'));
        renderDetailedTable(blData);
        
        // Update pijlen met echte data
        const windDirection = blData.find(item => item.ID === 'BL7WRS')?.Value || 270;
        const waveDirection = blData.find(item => item.ID === 'BLBRHF')?.Value || 240;
        
        // Verwijder bestaande pijlen
        map.eachLayer(layer => {
            if (layer instanceof L.Polyline && layer.options.arrowheads) {
                map.removeLayer(layer);
            }
        });
        
        // Voeg nieuwe pijlen toe
        addArrow(51.3180, 3.1400, windDirection, 100, 'red', `Wind ${windDirection}째`);
        addArrow(51.3180, 3.1450, waveDirection, 80, 'green', `Golven ${waveDirection}째`);
    };

    document.addEventListener('DOMContentLoaded', () => {
        loadData();
        setInterval(loadData, CONFIG.REFRESH_INTERVAL);
    });
  </script>

  <h2 id="linken"> Lokale surfschool : </h2>
  <div class="positieknop">
    <a href="https://www.beachclubblankenberge.be/" target="_blank" titel="lokale surfschool">
      <button id="surfschoolknop"></button>
    </a>
  </div>

  <h5 id="wing-title" class="form-title">Winfoil wing calculator :</h5>

  <div class="wingcalc-wrapper">
    <!-- Afbeelding links -->
    <div class="side-img-container">
      <img src="wingen.JPG" alt="Wing links" class="side-img" />
    </div>

    <!-- Formulier in het midden -->
    <div id="wingcalc-form">
      <label for="weight">Gewicht (kg):</label>
      <input type="number" id="weight" min="30" max="120" step="1" value="70" />

      <label for="wind">Windsnelheid (knopen):</label>
      <input type="number" id="wind" min="5" max="50" step="0.1" value="15" />

      <button onclick="calculateWingSize()">Bereken Wingmaat</button>

      <div class="result" id="result">Voer je gegevens in en klik op de knop.</div>
    </div>

    <!-- Afbeelding rechts -->
    <div class="side-img-container">
      <img src="wingen2.JPG" alt="Wing rechts" class="side-img" />
    </div>
  </div>

  <h5 id="kite-title" class="kite-title">Kitesize calculator :</h5>

  <div class="kitecalc-wrapper">
    <!-- Afbeelding links -->
    <div class="side-img-container">
      <img src="kiten afbeedling.jpg" alt="Kite links" class="side-img" />
    </div>

    <!-- Formulier in het midden -->
    <div id="kitecalc-form">
      <label for="kitecalc-weight">Gewicht (kg):</label>
      <input type="number" id="kitecalc-weight" min="30" max="120" step="1" value="70" />

      <label for="kitecalc-wind">Windsnelheid (knopen):</label>
      <input type="number" id="kitecalc-wind" min="5" max="50" step="0.1" value="15" />

      <button onclick="calculateKiteCalcSize()">Bereken kitemaat</button>

      <div id="kitecalc-result" class="result">Voer je gegevens in en klik op de knop.</div>
    </div>

    <!-- Afbeelding rechts -->
    <div class="side-img-container">
      <img src="kiten 2.jpg" alt="Kite rechts" class="side-img" />
    </div>
  </div>

  <div id="logo">
    <img src="company logo.png" alt="Company Logo" />
  </div>

  <section id="contact" class="contact">
    <h2>Contact : </h2>
    <div class="contact-info">
      <p><strong>Email:</strong> <a href="mailto:smedtronics.tech@gmail.com">smedtronics.tech@gmail.com</a></p>
    </div>
  </section>

  <footer>
    &copy; 2025 Smedtronics
  </footer>

<!-- Laad script.js zodat calculators werken -->
<script src="script.js"></script>

</body>

</html>